(window.webpackJsonp=window.webpackJsonp||[]).push([[4],{"Um/M":function(e,t,n){"use strict";n.r(t),n.d(t,"_frontmatter",(function(){return o})),n.d(t,"default",(function(){return c}));var a=n("k0FJ"),s=n("oedh"),r=(n("mXGw"),n("/FXl")),i=n("TjRS"),o=(n("aD51"),{});void 0!==o&&o&&o===Object(o)&&Object.isExtensible(o)&&!o.hasOwnProperty("__filemeta")&&Object.defineProperty(o,"__filemeta",{configurable:!0,value:{name:"_frontmatter",filename:"src/agent.mdx"}});var l={_frontmatter:o},p=i.a;function c(e){var t=e.components,n=Object(s.a)(e,["components"]);return Object(r.b)(p,Object(a.a)({},l,n,{components:t,mdxType:"MDXLayout"}),Object(r.b)("h2",{id:"guide"},"Guide"),Object(r.b)("p",null,"Parallelizing cypress tests means running different tests on multiple cypress agents at the same time. The ",Object(r.b)("a",{href:"https://docs.cypress.io/guides/guides/parallelization.html",parentName:"p"},"official Cypress documentation")," greatly explains why is it good."),Object(r.b)("p",null,"It is important to note that this project only replaces the original cypress dashboard. You will still need to set up (and pay for) a CI environment that runs cypress agents."),Object(r.b)("img",{src:"public/parallelization-diagram.png",alt:"Parallization diagram"}),Object(r.b)("h2",{id:"cypress-agent-configuration"},"Cypress agent configuration"),Object(r.b)("p",null,"Cypress agent is the tools that runs the tests. When an agent is configured to run test in parallel, it will try to connect a remote dashboard to coordinate the tests running order. When using sorry-cypress you'll need to override the default configuration and use an alternative URL. The next few sections explain how to reconfigure cypress agents for communicating with sorry-cypress."),Object(r.b)("h2",{id:"manual"},"Manual"),Object(r.b)("p",null,"Find cypress installation path"),Object(r.b)("pre",null,Object(r.b)("code",{className:"language-bash",parentName:"pre"},"$ DEBUG=cypress:* cypress version\n\n...\n# here it is\ncypress:cli Reading binary package.json from: /Users/agoldis/Library/Caches/Cypress/3.4.1/Cypress.app/Contents/Resources/app/package.json +0ms\n...\n")),Object(r.b)("p",null,"In my case it is: ",Object(r.b)("inlineCode",{parentName:"p"},"/Users/agoldis/Library/Caches/Cypress/3.4.1/Cypress.app/Contents/Resources/app/")),Object(r.b)("p",null,"Change the default dashboard URL"),Object(r.b)("pre",null,Object(r.b)("code",{className:"language-bash",parentName:"pre"},'$ cat /Users/agoldis/Library/Caches/Cypress/3.4.1/Cypress.app/Contents/Resources/app/packages/server/config/app.yml\n\n...\n# Replace this with a URL of the alternative dashboard\nproduction:\n  # api_url: "https://api.cypress.io/"\n  api_url: "http://localhost:1234/"\n...\n')),Object(r.b)("h2",{id:"cli-one-liners"},"CLI one-liners"),Object(r.b)("p",null,"Use this CLI one-liner to change cypress configuration (courtesy of ",Object(r.b)("a",{href:"https://github.com/MeStrak",parentName:"p"},"@MeStrak"),"):"),Object(r.b)("pre",null,Object(r.b)("code",{className:"language-bash",parentName:"pre"},"> sed -i -e 's|api_url:.*$|api_url: \"https://sorry-cypress-demo-director.herokuapp.com/\"|g' /*/.cache/Cypress/*/Cypress/resources/app/packages/server/config/app.yml\n")),Object(r.b)("p",null,"Or for windows (by ",Object(r.b)("a",{href:"https://github.com/nickcox",parentName:"p"},"@nickcox"),"):"),Object(r.b)("pre",null,Object(r.b)("code",{className:"language-powershell",parentName:"pre"},'ls $env:LOCALAPPDATA/Cypress/Cache -Recurse -Filter app.yml |\n% { (Get-Content $_ -Raw) -replace "https://api.cypress.io/", "https://sorry-cypress-demo-director.herokuapp.com/" | Out-File $_ }\n')),Object(r.b)("h2",{id:"sorry-cypress-wrapper"},"sorry-cypress wrapper"),Object(r.b)("p",null,"Thanks ",Object(r.b)("a",{href:"https://github.com/janineahn",parentName:"p"},"@janineahn")," and ",Object(r.b)("a",{href:"https://github.com/redaxmedia",parentName:"p"},"@redaxmedia")," for this contribution!"),Object(r.b)("p",null,"Instead of changing the ",Object(r.b)("inlineCode",{parentName:"p"},"api_url")," in the cypress config, it's also possible to reroute the cypress api IP in your ",Object(r.b)("inlineCode",{parentName:"p"},"/etc/hosts")," file."),Object(r.b)("p",null,"Sorry-cypress includes an executable helper for this, to use it run ",Object(r.b)("inlineCode",{parentName:"p"},"sudo sorry-cypress")," (superuser rights are necessary for editing the hosts file)."),Object(r.b)("p",null,"This command will use ",Object(r.b)("a",{href:"https://github.com/feross/hostile",parentName:"p"},"hostile")," to change your hosts file and will start cypress in a child process.\nOnce Cypress is done or killed the rerouting rule in your hosts file will be deleted."),Object(r.b)("p",null,"Please be aware of the following limitation before using ",Object(r.b)("inlineCode",{parentName:"p"},"sorry-cypress.js")," script:"),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},"Only works with ",Object(r.b)("inlineCode",{parentName:"li"},"etc/hosts")," or ",Object(r.b)("inlineCode",{parentName:"li"},"C:/Windows/System32/drivers/etc/hosts")," present"),Object(r.b)("li",{parentName:"ul"},"Only works with HTTPS on and port 443 on the target machine"),Object(r.b)("li",{parentName:"ul"},"Has hard coded arguments for the cypress run"),Object(r.b)("li",{parentName:"ul"},"Missing output that CLI started/finished")),Object(r.b)("p",null,"The command will need the following env variables:"),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"SORRY_CYPRESS_RECORD_KEY")),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"SORRY_CYPRESS_API_IP")),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"SORRY_CYPRESS_BUILD_ID"))),Object(r.b)("p",null,"Example:"),Object(r.b)("pre",null,Object(r.b)("code",{className:"language-sh",parentName:"pre"},"sudo SORRY_CYPRESS_BUILD_ID=build-001 SORRY_CYPRESS_RECORD_KEY=whateve SORRY_CYPRESS_API_IP=127.0.0.1 ./bin/sorry-cypress.js <other cypress arguments>\n")))}void 0!==c&&c&&c===Object(c)&&Object.isExtensible(c)&&!c.hasOwnProperty("__filemeta")&&Object.defineProperty(c,"__filemeta",{configurable:!0,value:{name:"MDXContent",filename:"src/agent.mdx"}}),c.isMDXComponent=!0}}]);
//# sourceMappingURL=component---src-agent-mdx-ccec24a2ea3b03598fda.js.map