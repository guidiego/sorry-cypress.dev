(window.webpackJsonp=window.webpackJsonp||[]).push([[7],{k4fJ:function(e,n,r){"use strict";r.r(n),r.d(n,"_frontmatter",(function(){return i})),r.d(n,"default",(function(){return p}));var t=r("k0FJ"),s=r("oedh"),c=(r("mXGw"),r("/FXl")),a=r("TjRS"),i=(r("aD51"),{});void 0!==i&&i&&i===Object(i)&&Object.isExtensible(i)&&!i.hasOwnProperty("__filemeta")&&Object.defineProperty(i,"__filemeta",{configurable:!0,value:{name:"_frontmatter",filename:"src/ci/aws-codebuild-b.mdx"}});var o={_frontmatter:i},l=a.a;function p(e){var n=e.components,r=Object(s.a)(e,["components"]);return Object(c.b)(l,Object(t.a)({},o,r,{components:n,mdxType:"MDXLayout"}),Object(c.b)("p",null,"This tutorial is contributed by ",Object(c.b)("a",{href:"https://github.com/KyleThenTR",parentName:"p"},"@KyleThenTR"),". The original text is available at ",Object(c.b)("a",{href:"https://github.com/agoldis/sorry-cypress/issues/6",parentName:"p"},"https://github.com/agoldis/sorry-cypress/issues/6"),"."),Object(c.b)("hr",null),Object(c.b)("p",null,"This first buildspec if what we use in our pipeline to verify an environment once we've already deployed. The second buildspec is one we use in our merge requests as a runner before we can merge into master (just to verify we aren't breaking anything)"),Object(c.b)("p",null,"The codebuilds are running on the cypress/browsers docker images ",Object(c.b)("a",{href:"https://hub.docker.com/r/cypress/browsers",parentName:"p"},"https://hub.docker.com/r/cypress/browsers")),Object(c.b)("p",null,Object(c.b)("inlineCode",{parentName:"p"},"buildspec-test.yml")),Object(c.b)("pre",null,Object(c.b)("code",{className:"language-yml",parentName:"pre"},'version: 0.2\n\nphases:\n  pre_build:\n    commands:\n      - npm ci\n      - npm install concurrently -g\n      - sed -i -E "s@(api_url:) (.*)@\\1 \\"${SORRY_CYPRESS_DIRECTOR_URL}\\"@g" ~/.cache/Cypress/3.8.3/Cypress/resources/app/packages/server/config/app.yml\n  build:\n    commands:\n      - Xvfb :99 &\n      - export DISPLAY=:99\n      - CYPRESS_CI_RUN_COMMAND="npm run cy:run -- --record --key ci-tests --parallel --ci-build-id CI-${CODEBUILD_START_TIME}-${CODEBUILD_BUILD_ID}"\n      - |\n        concurrently \\\n        "$CYPRESS_CI_RUN_COMMAND" \\\n        "$CYPRESS_CI_RUN_COMMAND" \\\n        "$CYPRESS_CI_RUN_COMMAND" \\\n        "$CYPRESS_CI_RUN_COMMAND" \\\n        "$CYPRESS_CI_RUN_COMMAND"\n      - pkill Xvfb\n  post_build:\n    commands:\n      - npm run cy:merge-results\n      - npm run cy:generate-report\n\nartifacts:\n  files:\n    - \'**/*\'\n  base-directory: \'./cypress/results\'\n')),Object(c.b)("p",null,Object(c.b)("inlineCode",{parentName:"p"},"buildspec-ci-test.yml")),Object(c.b)("pre",null,Object(c.b)("code",{className:"language-yml",parentName:"pre"},'version: 0.2\n\nenv:\n  git-credential-helper: yes\n\nphases:\n  pre_build:\n    commands:\n      - git fetch origin\n      - git merge origin/master --no-commit --no-ff\n      - npm ci\n      - npm install concurrently wait-on -g\n      - sed -i -E "s@(api_url:) (.*)@\\1 \\"${SORRY_CYPRESS_DIRECTOR_URL}\\"@g" ~/.cache/Cypress/3.8.3/Cypress/resources/app/packages/server/config/app.yml\n  build:\n    commands:\n      - npm run start-prod &\n      - Xvfb :99 &\n      - export DISPLAY=:99\n      - CYPRESS_CI_RUN_COMMAND="npm run cy:run -- --record --key ci-tests --parallel --ci-build-id Runner-${CODEBUILD_START_TIME}-${CODEBUILD_BUILD_ID}"\n      - |\n        wait-on http://localhost:3000 && concurrently \\\n        "$CYPRESS_CI_RUN_COMMAND" \\\n        "$CYPRESS_CI_RUN_COMMAND" \\\n        "$CYPRESS_CI_RUN_COMMAND" \\\n        "$CYPRESS_CI_RUN_COMMAND" \\\n        "$CYPRESS_CI_RUN_COMMAND"\n      - pkill Xvfb\n  post_build:\n    commands:\n      - npm run cy:merge-results\n      - npm run cy:generate-report\n\nartifacts:\n  files:\n    - \'**/*\'\n  base-directory: \'./cypress/results\'\n')))}void 0!==p&&p&&p===Object(p)&&Object.isExtensible(p)&&!p.hasOwnProperty("__filemeta")&&Object.defineProperty(p,"__filemeta",{configurable:!0,value:{name:"MDXContent",filename:"src/ci/aws-codebuild-b.mdx"}}),p.isMDXComponent=!0}}]);
//# sourceMappingURL=component---src-ci-aws-codebuild-b-mdx-ed13f0c9024c3a6bd3ff.js.map